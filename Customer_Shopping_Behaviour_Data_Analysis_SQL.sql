create database customer_behaviour;
use customer_behaviour;

select * from customer
limit 20;

-- Q1. What is the total revenue generated by male vs. female customers?
select Gender, sum(purchase_amount) as revenue from 
customer
group by Gender;

-- Q2. Which customers used a discount but still spent more than the average purchase amount? 
select customer_id, purchase_amount
from customer
where discount_applied = 'yes' and purchase_amount >= (select avg(purchase_amount) from customer);

-- Q3. Which are the top 5 products with the highest average review rating?
select item_purchased, round(avg(review_rating),1) as Avg_product_rating
from customer
group by item_purchased
order by Avg_product_rating desc
limit 5;

-- Q4. Compare the average Purchase Amounts between Standard and Express Shipping.
select shipping_type, round(avg(purchase_amount),2) as Amount
from customer
where shipping_type  in ('Standard','Express')
group by shipping_type; 


-- Q5. Do subscribed customers spend more? Compare average spend and total revenue between subscribers and non-subscribers.
select subscription_status, 
count(customer_id) as total_customers, 
round(avg(Purchase_amount),2) as Avg_spend,
sum(Purchase_amount) AS Total_Revenue
from customer
group by subscription_status
order by Total_revenue, Avg_spend
;

-- Q6. Which 5 products have the highest percentage of purchases with discounts applied?
select item_purchased, 
Round(100 * Sum(Case When Discount_applied = 'Yes' then 1 Else 0 END)/count(*),2) AS Discount_rate
from customer
group by item_purchased
order by discount_Rate desc
limit 5;

/*Q7. Segment customers into New, Returning, and Loyal based on their total number of previous purchases, 
and show the count of each segment.*/

with customer_type as(
select customer_id, previous_purchases, 
case
		when previous_purchases = 1 Then 'New'
        when previous_Purchases between 2 AND 10 THEN 'Returning'
		Else 'Loyal'
end as Customer_Segment
from customer 
)
select customer_segment         
        , count(*) as no_of_customers
        from customer_type
        group by customer_segment;

-- Q8. What are the top 3 most purchased products within each category?

with item_counts as (
select category, item_purchased,
count(customer_id) as total_orders,
Row_number() over (partition by category order by count(customer_id) desc) as item_rank
from customer
group by
category, item_purchased
)
select item_rank, category, item_purchased, total_orders
from item_Counts
where item_rank<= 3;

-- Q9. Are customers who are repeat buyers (more than 5 previous purchases) also likely to subscribe?
SELECT subscription_status, count(customer_id) as repeat_buyers
from customer
where previous_purchases > 5
group by subscription_status;

-- Q10. What is the revenue contribution of each age group?

select age_group, sum(purchase_amount) as Total_Revenue
from customer
group by age_group
order by Total_Revenue;